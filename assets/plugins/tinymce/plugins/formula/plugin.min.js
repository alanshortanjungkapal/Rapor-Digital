!function(e){function t(e,t){e.windowManager.open({title:"Formula",width:900,height:610,html:a(e,t),buttons:[{text:"Cancel",onclick:function(){this.parent().parent().close()}},{text:"Insert Formula",subtype:"primary",onclick:function(t){var a=this;window.frames.tinymceFormula&&window.frames.tinymceFormula.getData?window.frames.tinymceFormula.getData(function(t,n,i){t&&e.insertContent('<img class="fm-editor-equation" src="'+t+'" data-mlang="'+n+'" data-equation="'+encodeURIComponent(i)+'"/>'),a.parent().parent().close()}):a.parent().parent().close()}}]})}function a(e,t){var a=e.selection.getNode(),n=e.getParam("language")||"en",i="",o="";"img"==a.nodeName.toLowerCase()&&a.className.indexOf("fm-editor-equation")>-1&&(a.getAttribute("data-mlang")&&(i="&mlang="+a.getAttribute("data-mlang")),a.getAttribute("data-equation")&&(o="&equation="+a.getAttribute("data-equation")));var r='<iframe name="tinymceFormula" id="tinymceFormula" src="'+t+"/index.html?lang="+n+i+o+'" scrolling="no" frameborder="0"></iframe>';return r}e.create("tinymce.plugins.Formula",{init:function(e,a){var n=e.getParam("formula")||{},i=n.path||a;e.addButton("formula",{image:i+"/img/formula.png",tooltip:"Insert Formula",onclick:t.bind(this,e,i),onPostRender:function(){var t=this;e.on("NodeChange",function(e){t.active(e.element.className.indexOf("fm-editor-equation")>-1&&"img"==e.element.nodeName.toLowerCase())})}})}}),e.PluginManager.requireLangPack("formula","en,es,fr_FR"),e.PluginManager.add("formula",e.plugins.Formula)}(window.tinymce);